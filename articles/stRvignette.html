<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Package stR • stR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Package stR">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stRvignette.html">Package stR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/robjhyndman/stR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Package stR</h1>
                        <h4 data-toc-skip class="author">Alexander
Dokumentov</h4>
            
            <h4 data-toc-skip class="date">2024-07-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robjhyndman/stR/blob/master/vignettes/stRvignette.Rmd" class="external-link"><code>vignettes/stRvignette.Rmd</code></a></small>
      <div class="d-none name"><code>stRvignette.Rmd</code></div>
    </div>

    
    
<p>This vignette describes some functionality and provides a few
examples of how to use package stR. stR implements method STR, where STR
stands for Seasonal-Trend decomposition by Regression and capital R
emphasizes R, the name of the popular statistical software. The whole
name is also reminiscent of STL, the method which inspired me to
introduce STR.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>There are many packages and methods which work with seasonal data.
For example the oldest method for decomposition – classical additive
decomposition – is implemented in package <code>stats</code>. The method
splits the data into trend, seasonal and random components:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html" class="external-link">decompose</a></span><span class="op">(</span><span class="va">co2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>Another well known method is STL, implemented in packages
<code>stats</code> and <code>stlplus</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/stl.html" class="external-link">stl</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">co2</span><span class="op">)</span>, s.window <span class="op">=</span> <span class="st">"periodic"</span>, t.window <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>Other R packages which implement various versions of seasonal
decomposition and seasonal adjustment include <code>forecast</code>,
<code>x12</code>, <code>seasonal</code>, <code>season</code>,
<code>seas</code> and <code>deseasonalize</code>.</p>
<p>A few more examples are provided below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span></span>
<span><span class="va">co2.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/tbats.html" class="external-link">tbats</a></span><span class="op">(</span><span class="va">co2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">co2.fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.seasonal.website" class="external-link">seasonal</a></span><span class="op">)</span></span>
<span><span class="va">co2.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/seasonal/man/seas.html" class="external-link">seas</a></span><span class="op">(</span><span class="va">co2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">co2.fit</span>, trend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>After looking at the above examples, a reader might ask “Why do we
need another method of seasonal decomposition?”</p>
<p>A short answer is that</p>
<ol style="list-style-type: decimal">
<li>the new STR method has a richer set of features (and allows users to
implement even more features); and</li>
<li>the method has a well studied theoretical background (based on OLS
and quantile regression).</li>
</ol>
<p>This vignette provides some details on the first claim.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>For time series decomposition with objects of class <code>ts</code>
or class <code>msts</code>, and with no regressors or complex
seasonality, it is simple to do an STR decomposition using the
<code>AutoSTR</code> function.</p>
<p>For example, the <code>co2</code> time series can be decomposed as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">co2.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AutoSTR.html">AutoSTR</a></span><span class="op">(</span><span class="va">co2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">co2.fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="example-with-multiple-seasonality">Example with multiple seasonality<a class="anchor" aria-label="anchor" href="#example-with-multiple-seasonality"></a>
</h2>
<p>The time series <code>taylor</code> from package
<code>forecast</code> provides us with half-hourly electricity demand in
England and Wales. It exhibits (at least) two seasonalities – daily and
weekly. They can be observed in a 4 weeks’ subset of the data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taylor.msts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/msts.html" class="external-link">msts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">taylor</span><span class="op">)</span>, <span class="fl">336</span> <span class="op">*</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  seasonal.periods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">48</span> <span class="op">*</span> <span class="fl">7</span>, <span class="fl">48</span> <span class="op">*</span> <span class="fl">7</span> <span class="op">*</span> <span class="fl">52.25</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">2000</span> <span class="op">+</span> <span class="fl">22</span> <span class="op">/</span> <span class="fl">52</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">taylor.msts</span>, ylab <span class="op">=</span> <span class="st">"Electricity demand"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Since the data is at half hour granularity, the daily seasonality has
a period of 48 observations and weekly has a period of 336.</p>
<p>The data is of class <code>msts</code> (multiple seasonal time
series), which can also be handled automatically with
<code>AutoSTR</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taylor.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AutoSTR.html">AutoSTR</a></span><span class="op">(</span><span class="va">taylor.msts</span>, gapCV <span class="op">=</span> <span class="fl">48</span>, confidence <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">taylor.fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>The parameters supplied to <code>AutoSTR</code> are:</p>
<ul>
<li>
<code>gapCV = 48</code> – gaps of 48 observations are used for cross
validation</li>
<li>
<code>reltol = 0.001</code> – this parameter is passed directly to
<code>optim</code> function to control how well (and for how long) the
model parameters are optimized</li>
<li>
<code>confidence = 0.95</code> – 95% confidence intervals are
calculated (with assumptions: errors are uncorrelated, model parameters
are estimated exactly)</li>
</ul>
</div>
<div class="section level2">
<h2 id="tuning-an-str-decomposition">Tuning an STR decomposition<a class="anchor" aria-label="anchor" href="#tuning-an-str-decomposition"></a>
</h2>
<p>This example shows how to tune an STR decomposition, rather than use
the automated <code>AutoSTR</code> function. STR is a flexible method,
which can be adjusted to the data in multiple ways, making the interface
rather complex.</p>
<p>Let us consider the dataset <code>grocery</code> which contains
monthly data of supermarkets and grocery stores turnover in New South
Wales:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">grocery</span>, ylab <span class="op">=</span> <span class="st">"NSW Grocery Turnover, $ 10^6"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>We will use a log transformation to stabilize seasonal variance in
the data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logGr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">grocery</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">logGr</span>, ylab <span class="op">=</span> <span class="st">"NSW Grocery Turnover, log scale"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>At the next step we define trend and seasonal structures. Trend does
not have seasonality, therefore its seasonal structure contains only a
single knot: <code>c(1,0)</code>. Here a knot is defined as a pair of
numbers, both referring to the same point. The <code>segments</code>
component contains only one segment <code>c(0,1)</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trendSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The seasonal structure of the data is defined in the
<code>seasonalStructure</code> variable. The <code>segments</code>
component contains one pair of numbers <code>c(0,12)</code> which
defines ends the segment, while <code>sKnots</code> variable contains
seasonal knots from 1 to 12 (months). The last knot <code>c(0,12)</code>
also defines that ends of the segment <code>c(0,12)</code> are connected
and 0 and 12 represent the same knot (month December).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Variable <code>seasons</code> contains months corresponding to every
data point:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">cycle</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since trend does not have seasonality (the seasonal structure for the
trend contains only one season), the trend seasons are all ones:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trendSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>times</code> vector contains times corresponding to data
points:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>data</code> vector contains observations (in this case log
turnover):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span></span></code></pre></div>
<p><code>trendTimeKnots</code> vector contains times where time knots
for the trend are positioned:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trendTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">times</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">times</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  length.out <span class="op">=</span> <span class="fl">175</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>seasonTimeKnots</code> vector contains times where time
knots for the seasonal component are positioned:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasonTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">times</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">times</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  length.out <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In stR package every component of a decomposition is a regressor. In
the case of trend and seasonal components values for such regressors are
constants (vectors of ones):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trendData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The complete <code>trend</code> structure contains all components
relevant to the trend. Component <code>lambdas</code> is always a vector
with three elements. Trend, since it does not have seasonality, has only
the first element different from zero. This element defines smoothness
of the trend at the starting point of the optimization procedure.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">trendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">trendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">trendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">trendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The complete <code>season</code> structure contains all components
relevant to the trend. Component <code>lambdas</code> is a vector with
three elements. The elements define smoothness of the seasonal component
at starting point of the optimization procedure.</p>
<p>According to STR approach every non-static seasonal component has
two-dimensional structure (see the corresponding article on STR method).
In this particular case it has topology of a tube. The “observed”
seasonal component is a spiral subset of that “tube organised” data
(“observed” means here that the seasonal component is observed as part
of the data together with the trend and other components).</p>
<p>The first element of the vector defines smoothness of data along time
dimension of the tube. The second component defines smoothness along
seasonal dimension. And the third component defines smoothness in some
way in both dimensions (by restricting partial discrete derivative in
both directions).</p>
<p>The last two zeros in <code>lambdas</code> component mean that those
two components will not be optimized (and effectively two dimensional
structure of the seasonal component will not be used).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Yearly seasonality"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">seasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">seasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">seasonTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">seasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All components of STR decomposition are considered to be predictors.
For example trend is a predictor with no seasonality and independent
variable which is constant (and equal to one). The seasonal component is
a predictor with some predefined seasonality and a constant independent
variable (also equal to one).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">trend</span>, <span class="va">season</span><span class="op">)</span></span></code></pre></div>
<p>To calculate STR decomposition we supply data points, predictors,
required confidence intervals, the gap, to perform cross validation, and
reltol parameter which was described earlier.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gr.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">predictors</span>, confidence <span class="op">=</span> <span class="fl">0.95</span>, gap <span class="op">=</span> <span class="fl">1</span>, reltol <span class="op">=</span> <span class="fl">0.00001</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gr.fit</span>, xTime <span class="op">=</span> <span class="va">times</span>, forecastPanels <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-30-1.png" width="672"></p>
<p>In <code>plot</code> function <code>forecastPanels = NULL</code>
means that fit/forecast are not displayed.</p>
<p>If we decide to use two-dimensional structure for the seasonal
component we need to redefine <code>lambdas</code> component:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Yearly seasonality"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">seasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">seasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">seasonTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">seasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">trend</span>, <span class="va">season</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gr.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  <span class="va">predictors</span>,</span>
<span>  confidence <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  gap <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  reltol <span class="op">=</span> <span class="fl">0.00001</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This allows to find a set of parameters with a smaller cross
validated error, and therefore potentially more insightful
decomposition:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gr.fit</span>, xTime <span class="op">=</span> <span class="va">times</span>, forecastPanels <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-34-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="robust-str-decomposition">Robust STR decomposition<a class="anchor" aria-label="anchor" href="#robust-str-decomposition"></a>
</h2>
<p>Since STR is based on Ordinary Least Squares (OLS), it does not
tolerate outliers well. In the examples below I compare STR with its
robust version – Robust STR. The latter is based on quantile regression
approach (only 0.5 quantile is used), and therefore is robust to various
types of outliers.</p>
<p>Let us create a time series with two “spikes” to model two isolated
outliers:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grocery</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outl</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">900</span></span>
<span><span class="va">outl</span><span class="op">[</span><span class="fl">113</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">700</span></span>
<span><span class="va">tsOutl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">outl</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>and combine it with <code>grocery</code> time series</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logGrOutl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">grocery</span> <span class="op">+</span> <span class="va">tsOutl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">logGrOutl</span>, ylab <span class="op">=</span> <span class="st">"Log turnover with outliers"</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-36-1.png" width="672"></p>
<p>Decomposition of this time series with STR shows considerable
distortions in all components:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trendSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">seasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">cycle</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trendSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span></span>
<span><span class="va">timeKnots</span> <span class="op">&lt;-</span> <span class="va">times</span></span>
<span><span class="va">trendData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">trendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">timeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">trendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">seasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">seasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">timeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">seasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">trend</span>, <span class="va">season</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.str</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span>, <span class="va">predictors</span>, confidence <span class="op">=</span> <span class="fl">0.95</span>, gapCV <span class="op">=</span> <span class="fl">1</span>, reltol <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.str</span>, xTime <span class="op">=</span> <span class="va">times</span>, forecastPanels <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-40-1.png" width="672"></p>
<p>On the other hand Robust STR decomposition results in much cleaner
decomposition. The outliers appear only as residuals (component with
name “Random”) and trend and seasonal components are not distorted:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.rstr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">logGrOutl</span><span class="op">)</span>, <span class="va">predictors</span>, confidence <span class="op">=</span> <span class="fl">0.95</span>, gapCV <span class="op">=</span> <span class="fl">1</span>, reltol <span class="op">=</span> <span class="fl">0.001</span>, nMCIter <span class="op">=</span> <span class="fl">200</span>, robust <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.rstr</span>, xTime <span class="op">=</span> <span class="va">times</span>, forecastPanels <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="another-example-with-multiple-seasonality">Another example with multiple seasonality<a class="anchor" aria-label="anchor" href="#another-example-with-multiple-seasonality"></a>
</h2>
<p>Data set <code>calls</code> provides data about number of call
arrivals per 5-minute interval handled on weekdays between 7:00 am and
9:05 pm from March 3, 2003 in a large North American commercial
bank.</p>
<p>Below is an example of decomposition of <code>calls</code> data using
STR:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">timeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trendSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trendSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sKnotsDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">169</span>, length.out <span class="op">=</span> <span class="fl">169</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonalStructureDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">169</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="va">sKnotsDays</span></span>
<span><span class="op">)</span></span>
<span><span class="va">seasonsDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">169</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">sKnotsWeeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">169</span> <span class="op">*</span> <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">13</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonalStructureWeeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">169</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="va">sKnotsWeeks</span></span>
<span><span class="op">)</span></span>
<span><span class="va">seasonsWeeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="op">(</span><span class="fl">169</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span></span>
<span><span class="va">trendData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">calls</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">trendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">timeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">trendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seasonDays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">seasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">seasonsDays</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">seasonalStructureDays</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seasonWeeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">seasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">seasonsWeeks</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">seasonalStructureWeeks</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">500</span>, <span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">trend</span>, <span class="va">seasonDays</span>, <span class="va">seasonWeeks</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calls.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>  confidence <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  reltol <span class="op">=</span> <span class="fl">0.003</span>,</span>
<span>  nFold <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  gap <span class="op">=</span> <span class="fl">169</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">calls.fit</span>,</span>
<span>  xTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2003-03-03"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">169</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">169</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>,</span>
<span>  forecastPanels <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-47-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="a-complex-example">A complex example<a class="anchor" aria-label="anchor" href="#a-complex-example"></a>
</h2>
<p>Electricity consumption dataset <code>electricity</code> provides
information about electricity consumption in Victoria, Australia during
the 115 days starting on 10th of January, 2000, and comprises the
maximum electricity demand in Victoria during 30-minute periods (48
observations per day). For each 30-minute period, the dataset also
provides the air temperature in Melbourne.</p>
<p>In the example below the data is decomposed using weekly seasonal
pattern, daily seasonal pattern which takes into account weekends and
holidays and transition periods between them, and two flexible
predictors:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TrendSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">DailySeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WeeklySeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">336</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">332</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">336</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WDSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">148</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">47</span>, <span class="fl">101</span><span class="op">:</span><span class="fl">147</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span>, <span class="fl">100</span>, <span class="fl">148</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TrendSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DailySeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"DailySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">WeeklySeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"WeeklySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">WDSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"WorkingDaySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Consumption"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Time"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">TempM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Temperature"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">TempM2</span> <span class="op">&lt;-</span> <span class="va">TempM</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">TrendTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">116</span><span class="op">)</span></span>
<span><span class="va">SeasonTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">SeasonTimeKnots2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TrendData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SeasonData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TrendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WSeason</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Weekly seas"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SeasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">WeeklySeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">SeasonTimeKnots2</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">WeeklySeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WDSeason</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Daily seas"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SeasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">WDSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">SeasonTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">WDSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.003</span>, <span class="fl">0</span>, <span class="fl">240</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TrendTempM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend temp Mel"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TempM</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e7</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TrendTempM2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend temp Mel^2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TempM2</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e7</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Trend</span>, <span class="va">WSeason</span>, <span class="va">WDSeason</span>, <span class="va">TrendTempM</span>, <span class="va">TrendTempM2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">Data</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">Predictors</span>,</span>
<span>  confidence <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  gapCV <span class="op">=</span> <span class="fl">48</span> <span class="op">*</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elec.fit</span>,</span>
<span>  xTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-11"</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">Times</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">48</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  forecastPanels <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-51-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="a-forecasting-example">A forecasting example<a class="anchor" aria-label="anchor" href="#a-forecasting-example"></a>
</h2>
<p>The example below shows a simple way of forecasting seasonal data
using STR.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TrendSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">DailySeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">47</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WeeklySeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">336</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">332</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">336</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WDSeasonalStructure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">148</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">47</span>, <span class="fl">101</span><span class="op">:</span><span class="fl">147</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span>, <span class="fl">100</span>, <span class="fl">148</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TrendSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">DailySeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"DailySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">WeeklySeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"WeeklySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">WDSeasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"WorkingDaySeasonality"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Consumption"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Time"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">TempM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">electricity</span><span class="op">[</span>, <span class="st">"Temperature"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">TempM2</span> <span class="op">&lt;-</span> <span class="va">TempM</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">TrendTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">116</span><span class="op">)</span></span>
<span><span class="va">SeasonTimeKnots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">SeasonTimeKnots2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Times</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TrendData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SeasonData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Times</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TrendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1500</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WSeason</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Weekly seas"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SeasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">WeeklySeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">SeasonTimeKnots2</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">WeeklySeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">WDSeason</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Daily seas"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">SeasonData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">WDSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">SeasonTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">WDSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.003</span>, <span class="fl">0</span>, <span class="fl">240</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TrendTempM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend temp Mel"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TempM</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e7</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TrendTempM2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend temp Mel^2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TempM2</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e7</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Trend</span>, <span class="va">WSeason</span>, <span class="va">WDSeason</span>, <span class="va">TrendTempM</span>, <span class="va">TrendTempM2</span><span class="op">)</span></span></code></pre></div>
<p>The values, which need to be forecast, are supplied to STR as NAs. In
our case we are going to forecast the last week of the original
data.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">*</span> <span class="fl">48</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>The forecasting is performed at the same time when the model is
fitted.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">Data</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">Predictors</span>,</span>
<span>  confidence <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  gapCV <span class="op">=</span> <span class="fl">48</span> <span class="op">*</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result of the decomposition and forecasting is depicted
below.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elec.fit</span>,</span>
<span>  xTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-11"</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">Times</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">48</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  forecastPanels <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-56-1.png" width="672"></p>
<p>To check meaningfulness of the forecast it is advisable to plot beta
coefficients of the decomposition. If the coefficients are too “wiggly”
the forecast can be suboptimal.</p>
<p>Beta coefficients of the trend look a bit too “wiggly”. It explains
an uptrend in the forecast.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit</span>, predictorN <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-57-1.png" width="672"></p>
<p>Beta coefficients of weekly and daily seasonalities look smooth at
the end of the time series.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit</span>, predictorN <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit</span>, predictorN <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-58-1.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-58-2.png" width="672"></p>
<p>Beta coefficients for temperature and squared temperature predictors
look smooth.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit</span>, predictorN <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit</span>, predictorN <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-59-1.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-59-2.png" width="672"></p>
<p>Probably, the model can be re-estimated with a higher lambda
coefficient for the trend to provide a better forecast.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Trend"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">TrendData</span>,</span>
<span>  times <span class="op">=</span> <span class="va">Times</span>,</span>
<span>  seasons <span class="op">=</span> <span class="va">TrendSeasons</span>,</span>
<span>  timeKnots <span class="op">=</span> <span class="va">TrendTimeKnots</span>,</span>
<span>  seasonalStructure <span class="op">=</span> <span class="va">TrendSeasonalStructure</span>,</span>
<span>  lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150000</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Trend</span>, <span class="va">WSeason</span>, <span class="va">WDSeason</span>, <span class="va">TrendTempM</span>, <span class="va">TrendTempM2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec.fit.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STR.html">STR</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">Data</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">Predictors</span>,</span>
<span>  confidence <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  gapCV <span class="op">=</span> <span class="fl">48</span> <span class="op">*</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result gets much lower cross validated mean squared error.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elec.fit.2</span>,</span>
<span>  xTime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-11"</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">Times</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">48</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  forecastPanels <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-63-1.png" width="672"></p>
<p>Beta coefficients of the trend, seasonal components and predictors
look smooth.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/plotBeta.html">plotBeta</a></span><span class="op">(</span><span class="va">elec.fit.2</span>, predictorN <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="stRvignette_files/figure-html/unnamed-chunk-64-1.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-64-2.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-64-3.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-64-4.png" width="672"><img src="stRvignette_files/figure-html/unnamed-chunk-64-5.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="final-notes">Final notes<a class="anchor" aria-label="anchor" href="#final-notes"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>To achieve higher performance, it is recommended to use Intel MKL
for matrix operations.</p></li>
<li><p>Note, that registering a parallel backend while using Intel MKL
can reduce performance significantly since Intel MKL already tries to
utilise all available cores. In case if a user has options to use Intel
MKL or register a parallel backend (while using an ordinary computer,
for example 4 physical cores, 8 virtual cores), it is recommended to use
Intel MKL and do not register a parallel backend.</p></li>
<li><p>For testing and exploration purposes it is recommended to avoid
calculation of the confidence/forecasting intervals. Such calculation
currently involves inversion of a big matrix and can take long
time.</p></li>
<li><p>To monitor progress of the parameters’ estimation it is
recommended to set parameter trace to TRUE in STR call.</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Dokumentov, Rob Hyndman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
